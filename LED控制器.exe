KeyValue: LED PWM ENCODER 

PWM: STM32 TIMx Applitication and PWM(Pulse-Width Modulation) Configuration

STM32F10x具备有三类定时器,从简单到复杂可以分为: 基本定时器,通用定时器,高级定时器.

基本定时器: 只能具有最基本的计数功能,由此衍生的功能为定时,计时,定时中断;
通用定时器: 除了包含了基本定时器的功能外,还具有4个输入通道和输出通道,其输入/输出通道对应的是同一个IO. 输入模式支持实现的功能为输入捕获,计数模式,PWM输入模式,编码器接口模式; 输出模式可以实现的功能为PWM输出模式1/2(当占空比一致时,两者的波形为互补波形),输出比较模式等.而且TIM还具备了从模式功能,可以将一个定时器的输出作为另一定时器的预分频,从而实现慢速长时间的计时功能.
高级定时器: 除了包含了通用定时器外的所有功能外,在输出功能中还多出了4路互补输出通道,可以同时产生4路的互补PWM信号.除此之外,高级定时器还支持刹车、死区灯功能,这些功能在某些应用场合中尤为重要(例如在驱动H桥时,不能同时导通上半桥和下半桥,否则会导致电路短路.而死区可以让信号中具备死区时间,避免这样的情况发生).

相关概念介绍:
影子寄存器(Auto-reload shadow register): 对自动重加载寄存器(ARR Auto-reload register)的影子寄存器.一般而言,在计数过程中,需要将当前的计数值和自动重加载寄存器的值相比较,如果计数值等于其自动重加载值,则触发更新事件,如果在此过程中自动重加载寄存器的值被改变,则会以最新的自动重加载寄存器的值去比较,这可能会导致一些意想不到的问题(例如,如果CNT当前值为36,ARR为38,如果此时将ARR寄存器的值改为35,则CNT寄存器会一直往上加,直到溢出再回到35才能成功比较,这就可能与我们原本设想的不一致了).如果我们开启了影子寄存器(TIMx_CR1_ARPE 开启),则CNT是与影子寄存器的值相比较,如果改变了自动重加载寄存器的值,则在下一个更新事件中才会更新自动重加载寄存器的值到影子寄存器中(在上例中,将ARR改成35,但是影子还是38,此时CNT和影子比较,当CNT计数到38的时候便会触发更新事件,CNT清零,影子刷新为35,这样就会避免CNT溢出的情况).
对齐模式(Center-aligned mode selection): 可以配置为边沿对齐以及中央对齐,决定计数器计数到ARR值后是否要交替.
计数方向(Direction): CNT的计数方向,可以配置为向上计数和向下计数.
单脉冲模式(One pulse mode): 决定了在更新事件后计数器是否停止.

时钟选择:
1. 内部时钟(CK_INT): 定时器的时钟是由内部的TIM时钟提供,F103型号的默认时钟为72M.
2. 外部时钟模式1: 外部输入引脚触发
3. 外部时钟模式2: 外部触发输入ETR
4. 内部触发输入(ITRx): 使用一个定时器作为另一个定时器的预分频器

在PWM模式中,我们采用的是内部时钟;而在输入模式中一般是选择外部时钟模式1.

STM32F103的通用/高级定时器的输出模式配置如下:


本系统采用Cortex-M系列的芯片
1）Cortex-M系列芯片分类
Cortex-M系列芯片按照内核处理器速度不同可分：
①Cortex-M0系列：工作频率为48M。主要用于低功耗产品。
②Cortex-M3系列：工作频率为72M。主要特点为性能比较全面，行业覆盖面广。
③Cortex-M4系列：工作频率为168M。主要用于电源管理和嵌入式音频。










