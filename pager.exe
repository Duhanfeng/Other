#include <stdio.h> 
#include <string.h> 
typedef unsigned char uint8_t; 
typedef unsigned short int uint16_t;
typedef unsigned long int uint32_t;

#define RBUF_SIZE   (64)
#define RBUF_MASK   (RBUF_SIZE - 1)

#if RBUF_SIZE < 2
#error RBUF_SIZE is too small.  It must be larger than 1.
#elif ((RBUF_SIZE & (RBUF_SIZE-1)) != 0)
#error RBUF_SIZE must be a power of 2.
#endif

#define MAX_DIS_NUMBER  (5)

#define PAGER_DIS_CTRL_PAGE_UP      (0x01)
#define PAGER_DIS_CTRL_PAGE_DOWN    (0x02)


static uint8_t RecvBuff[RECV_BUF_SIZE] = {0};
static uint32_t HeadIndex = 0;
static uint32_t TailIndex = 0;
static uint32_t DisIndex = 0;

//Display All Devices(Max Display Value is MAX_DIS_NUMBER)
void PAGER_DisplayCurrentList(void)
{
    uint8_t i = 0;
    uint8_t TempDevBuff[MAX_DIS_NUMBER] = {0};
    uint8_t DisplayDevNumber = 0;

    //Get Current Display Devices Number
    DisplayDevNumber = TailIndex - DisIndex;
    DisplayDevNumber = (DisplayDevNumber > MAX_DIS_NUMBER) ? MAX_DIS_NUMBER : DisplayDevNumber;
    
    //Get Current Display Devices list
    for (i = 0; i < DisplayDevNumber; i++)
    {
        TempDevBuff[i] = RecvBuff[(DisIndex+i)&RBUF_MASK];
    }

    printf("DEV: %.2d %.2d %.2d %.2d %.2d", 
                            TempDevBuff[0],
                            TempDevBuff[1], 
                            TempDevBuff[2], 
                            TempDevBuff[3], 
                            TempDevBuff[4]);
}


//Display Control 
void PAGER_DisplayCtrl(uint8_t Code)
{
    switch (code)
    {
        //Page up
        case PAGER_DIS_CTRL_PAGE_UP:
        {
            DisIndex += 5;
            DisIndex = (DisIndex >= TailIndex) ? TailIndex-1 : DisIndex;
            break;
        }
        
        //Page Down
        case PAGER_DIS_CTRL_PAGE_DOWN:
        {
            DisIndex -= 5;
            DisIndex = (DisIndex < HeadIndex) ? HeadIndex : DisIndex;
            break;
        }
        default: break;
    }
    
    //Update Current List
    PAGER_DisplayCurrentList();

}


//Add New Device In Slave Devides List
void PAGER_AddInSlaveDevList(uint8_t DevAddr)
{
    RecvBuff[(TailIndex++)&RBUF_MASK] = DevAddr;

    PAGER_DisplayCurrentList();

}


//Free Head Device From Slave Devices List 
void PAGER_FreeHeadFromSlaveDevList(void)
{
    HeadIndex++;

    if (DisIndex <= HeadIndex)
    {
        DisIndex = HeadIndex;
    }
    
    PAGER_DisplayCurrentList();

}







